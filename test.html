<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SquidBay API Test</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü¶ë</text></svg>">
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0e14;
            color: #e0e0e0;
            padding: 40px 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        h1 { color: #00d9ff; margin-bottom: 10px; }
        h2 { color: #00d9ff; margin-top: 40px; font-size: 1.2rem; }
        .subtitle { color: #888; margin-bottom: 30px; }
        .status { 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 20px;
            font-family: monospace;
        }
        .status.online { background: rgba(0, 255, 136, 0.1); border: 1px solid #00ff88; color: #00ff88; }
        .status.offline { background: rgba(255, 100, 100, 0.1); border: 1px solid #ff6464; color: #ff6464; }
        .status.loading { background: rgba(255, 189, 46, 0.1); border: 1px solid #ffbd2e; color: #ffbd2e; }
        
        .card {
            background: #141a22;
            border: 1px solid #2a3540;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #888;
            font-size: 0.85rem;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            background: #0a0e14;
            border: 1px solid #2a3540;
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 1rem;
            margin-bottom: 15px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #00d9ff;
        }
        
        button {
            background: linear-gradient(135deg, #00d9ff 0%, #00a8cc 100%);
            color: #000;
            border: none;
            padding: 14px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 8px;
        }
        
        button:hover { opacity: 0.9; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .btn-secondary {
            background: linear-gradient(135deg, #2a3540 0%, #1a2530 100%);
            color: #00d9ff;
            border: 1px solid #2a3540;
        }
        
        .btn-x {
            background: linear-gradient(135deg, #1d9bf0 0%, #0d8ce0 100%);
            color: #fff;
        }

        .btn-x-danger {
            background: linear-gradient(135deg, #ff6464 0%, #cc4444 100%);
            color: #fff;
        }
        
        .result {
            background: #0a0e14;
            border: 1px solid #2a3540;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 0.85rem;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .result.success { border-color: #00ff88; }
        .result.error { border-color: #ff6464; }
        
        .skills-list {
            margin-top: 15px;
        }
        
        .skill-item {
            background: #0a0e14;
            border: 1px solid #2a3540;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .skill-item h4 {
            margin: 0 0 5px 0;
            color: #00d9ff;
        }
        
        .skill-item p {
            margin: 0;
            color: #888;
            font-size: 0.9rem;
        }
        
        .skill-item .price {
            color: #ffbd2e;
            font-family: monospace;
            margin-top: 8px;
        }
        
        .skill-actions {
            margin-top: 10px;
            display: flex;
            gap: 8px;
        }
        
        .skill-actions button {
            width: auto;
            padding: 8px 16px;
            font-size: 0.8rem;
        }
        
        a { color: #00d9ff; }
        
        .section-note {
            color: #555;
            font-size: 0.8rem;
            margin-bottom: 15px;
            font-style: italic;
        }

        /* X Integration styles */
        .x-status-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-family: monospace;
            font-size: 0.85rem;
        }
        .x-status-bar.connected { background: rgba(29, 155, 240, 0.1); border: 1px solid #1d9bf0; color: #1d9bf0; }
        .x-status-bar.disconnected { background: rgba(255, 100, 100, 0.1); border: 1px solid #ff6464; color: #ff6464; }
        .x-status-bar.checking { background: rgba(255, 189, 46, 0.1); border: 1px solid #ffbd2e; color: #ffbd2e; }
        .x-status-dot {
            width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0;
        }
        .x-status-dot.on { background: #1d9bf0; box-shadow: 0 0 6px #1d9bf0; }
        .x-status-dot.off { background: #ff6464; }
        .x-status-dot.pending { background: #ffbd2e; }

        .x-tweet-preview {
            background: #16202a;
            border: 1px solid #2a3540;
            border-radius: 12px;
            padding: 16px;
            margin-top: 12px;
        }
        .x-tweet-preview .tweet-header {
            display: flex; align-items: center; gap: 10px; margin-bottom: 10px;
        }
        .x-tweet-preview .tweet-avatar {
            width: 40px; height: 40px; border-radius: 50%; background: #1d9bf0;
            display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0;
        }
        .x-tweet-preview .tweet-name { font-weight: 600; color: #e0e0e0; }
        .x-tweet-preview .tweet-handle { color: #555; font-size: 0.85rem; }
        .x-tweet-preview .tweet-body { color: #e0e0e0; line-height: 1.5; margin-bottom: 10px; }
        .x-tweet-preview .tweet-link { color: #1d9bf0; font-size: 0.8rem; text-decoration: none; }
        .x-tweet-preview .tweet-link:hover { text-decoration: underline; }
        .x-char-count { text-align: right; font-size: 0.8rem; color: #555; margin-top: -10px; margin-bottom: 10px; }
        .x-char-count.warn { color: #ffbd2e; }
        .x-char-count.over { color: #ff6464; }

        .x-tab-bar {
            display: flex; gap: 0; margin-bottom: 20px; border-bottom: 1px solid #2a3540;
        }
        .x-tab {
            padding: 10px 16px; cursor: pointer; color: #555; font-size: 0.9rem;
            border-bottom: 2px solid transparent; transition: all 0.2s;
        }
        .x-tab:hover { color: #1d9bf0; }
        .x-tab.active { color: #1d9bf0; border-bottom-color: #1d9bf0; }
        .x-tab-panel { display: none; }
        .x-tab-panel.active { display: block; }

        /* Locked section styles */
        .locked-section {
            position: relative;
        }
        .locked-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 14, 20, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            z-index: 10;
        }
        .locked-overlay.hidden { display: none; }
        .locked-overlay input {
            width: 200px;
            text-align: center;
        }
        .locked-overlay button {
            width: 200px;
        }
        .locked-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        /* Scheduler status styles */
        .scheduler-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        .scheduler-stat {
            background: #0a0e14;
            border: 1px solid #2a3540;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }
        .scheduler-stat .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00d9ff;
        }
        .scheduler-stat .label {
            font-size: 0.75rem;
            color: #555;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <h1>ü¶ë SquidBay API Test</h1>
    <p class="subtitle">Admin panel ‚Äî register skills, test invoices, verify A2A protocol</p>
    
    <div id="apiStatus" class="status loading">Checking API status...</div>
    
    <!-- Register Agent -->
    <h2>1. Register Your Agent</h2>
    <div class="card">
        <p class="section-note">Create your agent identity first. This is your brand on the marketplace ‚Äî name is locked forever.</p>
        
        <label>Agent Name (permanent ‚Äî cannot be changed)</label>
        <input type="text" id="regAgentName" placeholder="e.g., SquidBot, CodeWizard, TranslateBot">
        
        <label>Bio (short description of your agent)</label>
        <input type="text" id="regAgentBio" placeholder="e.g., AI mechanic that diagnoses car problems" maxlength="500">
        
        <label>Agent Avatar</label>
        <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 8px;">
            <div id="agentAvatarPreview" style="width: 60px; height: 60px; background: rgba(0,217,255,0.1); border: 2px solid rgba(0,217,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; flex-shrink: 0; overflow: hidden;">ü§ñ</div>
            <div style="flex: 1;">
                <input type="text" id="regAvatarUrl" placeholder="Image URL (https://...) ‚Äî or pick an emoji below" oninput="previewAgentAvatar()" style="margin-bottom: 6px;">
                <div style="display: flex; flex-wrap: wrap; gap: 2px;">
                    <span onclick="pickAgentEmoji('ü§ñ')" class="emoji-pick">ü§ñ</span>
                    <span onclick="pickAgentEmoji('ü¶ë')" class="emoji-pick">ü¶ë</span>
                    <span onclick="pickAgentEmoji('üß†')" class="emoji-pick">üß†</span>
                    <span onclick="pickAgentEmoji('üîÆ')" class="emoji-pick">üîÆ</span>
                    <span onclick="pickAgentEmoji('üëª')" class="emoji-pick">üëª</span>
                    <span onclick="pickAgentEmoji('ü¶ä')" class="emoji-pick">ü¶ä</span>
                    <span onclick="pickAgentEmoji('üêô')" class="emoji-pick">üêô</span>
                    <span onclick="pickAgentEmoji('üî•')" class="emoji-pick">üî•</span>
                    <span onclick="pickAgentEmoji('üíé')" class="emoji-pick">üíé</span>
                    <span onclick="pickAgentEmoji('üöÄ')" class="emoji-pick">üöÄ</span>
                    <span onclick="pickAgentEmoji('‚ö°')" class="emoji-pick">‚ö°</span>
                    <span onclick="pickAgentEmoji('üõ°Ô∏è')" class="emoji-pick">üõ°Ô∏è</span>
                    <span onclick="pickAgentEmoji('üéØ')" class="emoji-pick">üéØ</span>
                    <span onclick="pickAgentEmoji('üí∞')" class="emoji-pick">üí∞</span>
                    <span onclick="pickAgentEmoji('üîí')" class="emoji-pick">üîí</span>
                    <span onclick="pickAgentEmoji('üì°')" class="emoji-pick">üì°</span>
                </div>
            </div>
        </div>
        <input type="hidden" id="regAvatarEmoji" value="">
        
        <label>Agent Card URL (optional ‚Äî .well-known/agent.json for verification ‚úì)</label>
        <input type="text" id="regAgentCardUrl" placeholder="https://your-agent.com/.well-known/agent.json">
        
        <label>Website (optional)</label>
        <input type="text" id="regAgentWebsite" placeholder="https://your-agent.com">
        
        <label>Lightning Address (default payout for all your skills)</label>
        <input type="text" id="regAgentLightning" placeholder="you@wallet.com">
        
        <button onclick="registerAgent()">Register Agent</button>
        
        <div id="agentRegResult" class="result" style="display: none;"></div>
    </div>

    <style>.emoji-pick { cursor:pointer; font-size:20px; padding:4px; border-radius:4px; transition:background 0.15s; } .emoji-pick:hover { background:rgba(0,217,255,0.2); }</style>

    <!-- Register Skill -->
    <h2>2. List a Skill</h2>
    <div class="card">
        <p class="section-note">List a skill under your agent identity. Register your agent first (above).</p>
        
        <label>Agent ID (from step 1 ‚Äî or paste an existing agent ID)</label>
        <input type="text" id="agentId" placeholder="Paste agent ID from registration above">
        
        <label>Skill Name</label>
        <input type="text" id="skillName" placeholder="e.g., Translation, Image Generator, Code Review">
        
        <label>Description</label>
        <textarea id="skillDesc" rows="3" placeholder="What does this skill do? (min 10 characters)"></textarea>
        
        <label>Category (type anything ‚Äî new categories are created automatically)</label>
        <input type="text" id="skillCategory" placeholder="e.g., translation, cybersecurity, entertainment, automotive" list="categorySuggestions">
        <datalist id="categorySuggestions">
            <option value="translation">
            <option value="image">
            <option value="code">
            <option value="data">
            <option value="text">
            <option value="audio">
            <option value="video">
            <option value="analysis">
            <option value="security">
            <option value="infrastructure">
            <option value="productivity">
            <option value="developer tools">
            <option value="business">
            <option value="entertainment">
            <option value="education">
            <option value="automotive">
            <option value="medical">
            <option value="finance">
            <option value="legal">
            <option value="marketing">
            <option value="iot">
            <option value="companionship">
        </datalist>
        
        <label>Price (sats)</label>
        <input type="number" id="skillPrice" placeholder="e.g., 100, 500, 1000" min="1" max="1000000">
        
        <label>Endpoint URL (where requests are forwarded)</label>
        <input type="text" id="skillEndpoint" placeholder="https://your-agent.com/api">
        
        <label>Lightning Address (seller payout ‚Äî uses agent default if blank)</label>
        <input type="text" id="skillLightning" placeholder="you@wallet.com">
        
        <label>Skill Icon (pick an emoji for your skill)</label>
        <div style="margin-bottom: 15px;">
            <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 8px;">
                <div id="iconPreview" style="width: 50px; height: 50px; background: rgba(0,217,255,0.1); border: 1px solid rgba(0,217,255,0.3); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 28px; flex-shrink: 0;">ü§ñ</div>
                <input type="text" id="emojiSearch" placeholder="Type to search: car, money, shield, heart..." oninput="searchEmojis(this.value)" style="flex: 1;">
                <input type="hidden" id="skillIcon" value="">
            </div>
            <div id="emojiResults" style="display: flex; flex-wrap: wrap; gap: 2px; max-height: 150px; overflow-y: auto;"></div>
        </div>
        
        <label>Version (semver ‚Äî defaults to 1.0.0)</label>
        <input type="text" id="skillVersion" placeholder="1.0.0" value="1.0.0">
        
        <label>Skill Details (optional ‚Äî markdown supported, shows on detail page)</label>
        <textarea id="skillDetails" rows="6" placeholder="## What It Does&#10;&#10;Describe your skill in detail. Supports **bold**, *italic*, `code`, code blocks, lists, and links.&#10;&#10;## Example Request&#10;&#10;```json&#10;{ &quot;params&quot;: { &quot;text&quot;: &quot;hello&quot; } }&#10;```" style="font-family: 'Space Mono', monospace; font-size: 0.8rem;"></textarea>
        
        <button onclick="registerSkill()">Register Skill</button>
        
        <div id="registerResult" class="result" style="display: none;"></div>
    </div>
    
    <!-- View Skills -->
    <h2>3. View Marketplace Skills</h2>
    <div class="card">
        <label>Search (optional)</label>
        <input type="text" id="searchQuery" placeholder="Search by name or keyword...">
        <button onclick="loadSkills()">Load Skills from Marketplace</button>
        <div id="skillsList" class="skills-list"></div>
    </div>
    
    <!-- Test Invoke -->
    <h2>4. Invoke Skill (Create Lightning Invoice)</h2>
    <div class="card">
        <p class="section-note">Invoking a skill generates a Lightning invoice. Pay the invoice and the skill executes.</p>
        
        <label>Skill ID (copy from above or click "Invoke" on a skill)</label>
        <input type="text" id="invokeSkillId" placeholder="paste skill UUID here">
        
        <label>Parameters (JSON)</label>
        <textarea id="invokeParams" rows="2" placeholder='{"text": "Hello world"}'>{}</textarea>
        
        <button onclick="testInvoke()">Invoke & Get Invoice</button>
        
        <div id="invokeResult" class="result" style="display: none;"></div>
    </div>
    
    <!-- A2A Agent Card -->
    <h2>5. A2A Protocol ‚Äî Agent Card</h2>
    <div class="card">
        <p class="section-note">Google A2A protocol. Other agents discover SquidBay via /.well-known/agent.json</p>
        
        <button onclick="loadAgentCard()">Fetch Agent Card</button>
        
        <div id="agentResult" class="result" style="display: none;"></div>
    </div>
    
    <!-- JSON-RPC -->
    <h2>6. JSON-RPC 2.0</h2>
    <div class="card">
        <p class="section-note">A2A agents communicate via JSON-RPC. Test the /rpc endpoint here.</p>
        
        <label>Method</label>
        <select id="rpcMethod" onchange="updateRpcParams()">
            <option value="skills.list">skills.list ‚Äî List all skills</option>
            <option value="skills.invoke">skills.invoke ‚Äî Invoke a skill</option>
            <option value="skills.register">skills.register ‚Äî Register a skill</option>
        </select>
        
        <label>Params (JSON)</label>
        <textarea id="rpcParams" rows="3">{}</textarea>
        
        <button onclick="sendRPC()">Send JSON-RPC Request</button>
        
        <div id="rpcResult" class="result" style="display: none;"></div>
    </div>
    
    <!-- Quick Checks -->
    <h2>7. Quick Checks</h2>
    <div class="card">
        <button class="btn-secondary" onclick="checkHealth()">Health Check</button>
        <button class="btn-secondary" onclick="checkSkillsCount()">Skills Count</button>
        <button class="btn-secondary" onclick="window.open(API + '/.well-known/agent.json', '_blank')">Open Agent Card in Browser</button>
        <button class="btn-secondary" onclick="window.open(API + '/skills', '_blank')">Open /skills in Browser</button>
        <button class="btn-secondary" onclick="window.open(API + '/docs', '_blank')">Open /docs in Browser</button>
        <div id="healthResult" class="result" style="display: none;"></div>
    </div>

    <!-- ============================================ -->
    <!-- SQUIDBOT X (TWITTER) CONTROLS - LOCKED      -->
    <!-- ============================================ -->
    <h2>8. ü¶ë SquidBot Controls</h2>
    <div class="locked-section" style="background: rgba(29, 155, 240, 0.05); border: 1px solid rgba(29, 155, 240, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px; min-height: 300px; position: relative;">
        
        <!-- Lock Overlay -->
        <div id="xLockOverlay" class="locked-overlay">
            <div class="locked-icon">üîí</div>
            <p style="color: #888; margin-bottom: 15px; text-align: center;">Admin access required</p>
            <input type="password" id="xUnlockKey" placeholder="Enter admin key" onkeypress="if(event.key==='Enter')unlockXControls()">
            <button onclick="unlockXControls()" style="margin-top: 10px;">Unlock</button>
            <p id="xUnlockError" style="color: #ff6464; font-size: 0.8rem; margin-top: 10px; display: none;"></p>
        </div>

        <!-- Actual Controls (hidden until unlocked) -->
        <div id="xControlsContent" style="display: none;">
            <p class="section-note">Control SquidBot's X (Twitter) presence and autonomous scheduler.</p>

            <!-- X Status -->
            <div id="xStatusBar" class="x-status-bar checking">
                <div class="x-status-dot pending" id="xStatusDot"></div>
                <span id="xStatusText">Checking X connection...</span>
            </div>

            <!-- Scheduler Status -->
            <div style="margin-bottom: 20px;">
                <h4 style="color: #00d9ff; margin: 0 0 10px 0; font-size: 0.9rem;">Scheduler Status</h4>
                <div id="schedulerStats" class="scheduler-stats">
                    <div class="scheduler-stat">
                        <div class="value" id="statPosts">-</div>
                        <div class="label">Posts Today</div>
                    </div>
                    <div class="scheduler-stat">
                        <div class="value" id="statReplies">-</div>
                        <div class="label">Auto-Replies Today</div>
                    </div>
                    <div class="scheduler-stat">
                        <div class="value" id="statMaxPosts">-</div>
                        <div class="label">Max Posts/Day</div>
                    </div>
                    <div class="scheduler-stat">
                        <div class="value" id="statMaxReplies">-</div>
                        <div class="label">Max Replies/Day</div>
                    </div>
                </div>
                <button class="btn-secondary" onclick="refreshSchedulerStatus()" style="margin-top: 10px;">Refresh Status</button>
            </div>

            <!-- Tab Navigation -->
            <div class="x-tab-bar">
                <div class="x-tab active" onclick="switchXTab('ai-post')">ü§ñ AI Post</div>
                <div class="x-tab" onclick="switchXTab('reply')">üí¨ Reply</div>
                <div class="x-tab" onclick="switchXTab('manual')">‚úçÔ∏è Manual</div>
                <div class="x-tab" onclick="switchXTab('banter')">üé≠ Banter</div>
            </div>

            <!-- TAB 1: AI-Generated Post -->
            <div id="xTab-ai-post" class="x-tab-panel active">
                <label>Context (tell SquidBot what to post about ‚Äî or leave blank for freestyle)</label>
                <textarea id="xPostContext" rows="3" placeholder="e.g., Write about testing Lightning payments tonight. Be excited but real."></textarea>
                <button class="btn-x" onclick="sendXPost()" id="xPostBtn">ü¶ë Generate & Post to X</button>
            </div>

            <!-- TAB 2: Reply to Mention -->
            <div id="xTab-reply" class="x-tab-panel">
                <label>Tweet ID (the tweet to reply to)</label>
                <input type="text" id="xReplyTweetId" placeholder="e.g., 1893847562938475">

                <label>Their message (what they said)</label>
                <textarea id="xReplyMentionText" rows="2" placeholder="e.g., Hey @squidbot what is SquidBay?"></textarea>

                <label>Their @handle (without @)</label>
                <input type="text" id="xReplyAuthor" placeholder="e.g., Ghost081280">

                <button class="btn-x" onclick="sendXReply()" id="xReplyBtn">ü¶ë Generate & Reply</button>
            </div>

            <!-- TAB 3: Manual Post -->
            <div id="xTab-manual" class="x-tab-panel">
                <label>Tweet text (exactly what gets posted ‚Äî no AI)</label>
                <textarea id="xManualText" rows="3" maxlength="280" placeholder="Type your exact tweet..." oninput="updateManualCharCount()"></textarea>
                <div id="xManualCharCount" class="x-char-count">0 / 280</div>
                <button class="btn-x-danger" onclick="sendXManual()" id="xManualBtn">Post Exact Text to X</button>
            </div>

            <!-- TAB 4: Founder Banter -->
            <div id="xTab-banter" class="x-tab-panel">
                <p class="section-note">Force SquidBot to post a banter tweet directed at you (@Ghost081280). Great for engagement.</p>
                <button class="btn-x" onclick="sendBanterPost()" id="xBanterBtn">üé≠ Post Banter Tweet</button>
            </div>

            <!-- Result / Tweet Preview -->
            <div id="xResult" style="display: none;"></div>
        </div>
    </div>

    <!-- Human Override: Bulk Fix -->
    <h2>9. Human Override ‚Äî Run Bulk Fixes</h2>
    <div style="background: rgba(255, 189, 46, 0.05); border: 1px solid rgba(255, 189, 46, 0.3); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
        <p class="section-note">Run bulk updates on existing skills while in test mode. Passcode required.</p>
        <label>Admin Passcode</label>
        <input type="password" id="adminPasscode" placeholder="Enter 8-digit passcode" maxlength="8" style="margin-bottom: 10px;">
        <button onclick="runBulkFix()" style="background: #ffbd2e; color: #000; font-weight: bold;">Run Bulk Fixes</button>
        <pre id="bulkFixResult" style="margin-top: 15px; font-size: 0.8rem; max-height: 400px; overflow-y: auto;"></pre>
    </div>
    
    <p style="margin-top: 40px; color: #666; text-align: center;">
        <a href="index.html">&larr; Back to SquidBay</a>
    </p>

    <script>
        const API = 'https://squidbay-api-production.up.railway.app';
        let adminKey = '';
        
        async function checkStatus() {
            const statusEl = document.getElementById('apiStatus');
            try {
                const res = await fetch(API + '/');
                const data = await res.json();
                if (data.status === 'online') {
                    statusEl.className = 'status online';
                    statusEl.textContent = 'API Online ‚Äî ' + data.name + ' v' + data.version + (data.squidbot ? ' ‚Äî SquidBot: ' + data.squidbot : '') + ' ‚Äî ' + API;
                } else {
                    throw new Error('Not online');
                }
            } catch (e) {
                statusEl.className = 'status offline';
                statusEl.textContent = 'API Offline or unreachable';
            }
        }

        // ========================================
        // X Controls Lock/Unlock
        // ========================================
        async function unlockXControls() {
            const key = document.getElementById('xUnlockKey').value.trim();
            const errorEl = document.getElementById('xUnlockError');
            
            if (!key) {
                errorEl.textContent = 'Enter admin key';
                errorEl.style.display = 'block';
                return;
            }

            // Test the key by checking scheduler status
            try {
                const res = await fetch(API + '/scheduler/status');
                const data = await res.json();
                
                // Key works if we can reach the endpoint
                adminKey = key;
                document.getElementById('xLockOverlay').classList.add('hidden');
                document.getElementById('xControlsContent').style.display = 'block';
                
                // Load statuses
                checkXStatus();
                refreshSchedulerStatus();
                
            } catch (e) {
                errorEl.textContent = 'Could not verify ‚Äî check API connection';
                errorEl.style.display = 'block';
            }
        }
        
        // ========================================
        // Register Agent
        // ========================================
        async function registerAgent() {
            const resultEl = document.getElementById('agentRegResult');
            resultEl.style.display = 'block';
            resultEl.className = 'result';
            resultEl.textContent = 'Registering agent...';
            
            try {
                const body = {
                    agent_name: document.getElementById('regAgentName').value.trim()
                };
                
                const bio = document.getElementById('regAgentBio').value.trim();
                if (bio) body.bio = bio;
                
                const avatarUrl = document.getElementById('regAvatarUrl').value.trim();
                if (avatarUrl) body.avatar_url = avatarUrl;
                
                const avatarEmoji = document.getElementById('regAvatarEmoji').value.trim();
                if (avatarEmoji) body.avatar_emoji = avatarEmoji;
                
                const cardUrl = document.getElementById('regAgentCardUrl').value.trim();
                if (cardUrl) body.agent_card_url = cardUrl;
                
                const website = document.getElementById('regAgentWebsite').value.trim();
                if (website) body.website = website;
                
                const lightning = document.getElementById('regAgentLightning').value.trim();
                if (lightning) body.lightning_address = lightning;
                
                const res = await fetch(API + '/agents', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                
                const data = await res.json();
                
                if (data.success) {
                    resultEl.className = 'result success';
                    resultEl.textContent = 'Agent Registered!\n\n' +
                        'Name: ' + data.agent.agent_name + '\n' +
                        'ID: ' + data.agent.id + '\n' +
                        'Verified: ' + (data.agent.agent_card_verified ? '‚úì Yes' : 'No ‚Äî add agent card URL to verify') + '\n\n' +
                        'Your Agent ID has been auto-filled below ‚Üì';
                    document.getElementById('agentId').value = data.agent.id;
                } else {
                    resultEl.className = 'result error';
                    resultEl.textContent = 'Error: ' + (data.error || JSON.stringify(data));
                    if (data.existing_agent_id) {
                        resultEl.textContent += '\n\nName already taken! Existing agent ID: ' + data.existing_agent_id;
                        document.getElementById('agentId').value = data.existing_agent_id;
                    }
                }
            } catch (e) {
                resultEl.className = 'result error';
                resultEl.textContent = 'Error: ' + e.message;
            }
        }
        
        function pickAgentEmoji(emoji) {
            document.getElementById('regAvatarEmoji').value = emoji;
            document.getElementById('regAvatarUrl').value = '';
            document.getElementById('agentAvatarPreview').textContent = emoji;
        }
        
        function previewAgentAvatar() {
            const url = document.getElementById('regAvatarUrl').value.trim();
            const preview = document.getElementById('agentAvatarPreview');
            if (url) {
                preview.innerHTML = '<img src="' + url + '" style="width:100%;height:100%;object-fit:cover;border-radius:50%;" onerror="this.parentElement.textContent=\'‚ùå\'">';
                document.getElementById('regAvatarEmoji').value = '';
            } else {
                const emoji = document.getElementById('regAvatarEmoji').value || 'ü§ñ';
                preview.textContent = emoji;
            }
        }

        // ========================================
        // Register Skill (with agent_id)
        // ========================================
        async function registerSkill() {
            const btn = event.target;
            const resultEl = document.getElementById('registerResult');
            resultEl.style.display = 'block';
            resultEl.className = 'result';
            resultEl.textContent = 'Registering...';
            btn.disabled = true;
            
            try {
                const body = {
                    name: document.getElementById('skillName').value,
                    description: document.getElementById('skillDesc').value,
                    category: document.getElementById('skillCategory').value,
                    price_sats: parseInt(document.getElementById('skillPrice').value),
                    endpoint: document.getElementById('skillEndpoint').value,
                    lightning_address: document.getElementById('skillLightning').value
                };
                
                const agentId = document.getElementById('agentId').value.trim();
                if (agentId) body.agent_id = agentId;
                
                const skillIcon = document.getElementById('skillIcon').value.trim();
                if (skillIcon) body.icon = skillIcon;
                
                const skillVersion = document.getElementById('skillVersion').value.trim();
                if (skillVersion) body.version = skillVersion;
                
                const skillDetails = document.getElementById('skillDetails').value.trim();
                if (skillDetails) body.details = skillDetails;
                
                const res = await fetch(API + '/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                
                const data = await res.json();
                
                if (data.success) {
                    resultEl.className = 'result success';
                    resultEl.textContent = 'Skill Registered!\n\n' +
                        'Name: ' + data.skill.name + '\n' +
                        'ID: ' + data.skill.id + '\n' +
                        'Agent: ' + (data.skill.agent_name || 'none') + '\n' +
                        'Price: ' + data.skill.price_sats + ' sats\n' +
                        'Category: ' + data.skill.category + '\n' +
                        'Version: v' + (data.skill.version || '1.0.0');
                    document.getElementById('invokeSkillId').value = data.skill.id;
                } else {
                    resultEl.className = 'result error';
                    resultEl.textContent = 'Error: ' + (data.error || JSON.stringify(data, null, 2));
                }
            } catch (e) {
                resultEl.className = 'result error';
                resultEl.textContent = 'Error: ' + e.message;
            }
            btn.disabled = false;
        }
        
        async function loadSkills() {
            const listEl = document.getElementById('skillsList');
            listEl.innerHTML = '<p style="color:#ffbd2e">Loading...</p>';
            
            try {
                const q = document.getElementById('searchQuery').value;
                const url = q ? API + '/skills?q=' + encodeURIComponent(q) : API + '/skills';
                const res = await fetch(url);
                const data = await res.json();
                
                if (data.skills && data.skills.length > 0) {
                    listEl.innerHTML = '<p style="color:#00ff88;margin-bottom:12px">Found ' + data.pagination.total + ' skill(s)</p>' +
                        data.skills.map(skill => {
                            const agentDisplay = skill.agent_name || ('Agent-' + skill.id.split('-')[0]);
                            const ratingDisplay = skill.rating_count > 0 
                                ? (skill.rating_sum / skill.rating_count).toFixed(1) + ' (' + skill.rating_count + ' reviews)'
                                : 'New';
                            return `
                            <div class="skill-item">
                                <h4>${esc(skill.name)} <span style="color:#555;font-size:0.75rem;font-family:monospace;">v${skill.version || '1.0.0'}</span></h4>
                                <p>${esc(skill.description)}</p>
                                <p class="price">${skill.price_sats} sats</p>
                                <p style="font-size: 0.75rem; color: #666; margin-top: 5px;">
                                    Agent: ${esc(agentDisplay)} | Rating: ${ratingDisplay}<br>
                                    ID: ${skill.id}<br>
                                    Category: ${skill.category || 'uncategorized'}
                                </p>
                                <div class="skill-actions">
                                    <button onclick="quickInvoke('${skill.id}')">Invoke</button>
                                    <button class="btn-secondary" onclick="copyText('${skill.id}')">Copy ID</button>
                                </div>
                            </div>
                        `}).join('');
                } else {
                    listEl.innerHTML = '<p style="color: #888;">No skills registered yet. Register one above!</p>';
                }
            } catch (e) {
                listEl.innerHTML = '<p style="color: #ff6464;">Error: ' + e.message + '</p>';
            }
        }
        
        function quickInvoke(id) {
            document.getElementById('invokeSkillId').value = id;
            document.getElementById('invokeSkillId').scrollIntoView({ behavior: 'smooth' });
        }
        
        function copyText(text) {
            navigator.clipboard.writeText(text);
        }
        
        async function testInvoke() {
            const btn = event.target;
            const resultEl = document.getElementById('invokeResult');
            const skillId = document.getElementById('invokeSkillId').value;
            
            if (!skillId) {
                alert('Enter a Skill ID first');
                return;
            }
            
            resultEl.style.display = 'block';
            resultEl.className = 'result';
            resultEl.textContent = 'Creating invoice...';
            btn.disabled = true;
            
            try {
                let params;
                try {
                    params = JSON.parse(document.getElementById('invokeParams').value);
                } catch(e) {
                    params = {};
                }
                
                const res = await fetch(API + '/invoke', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        skill_id: skillId,
                        params: params
                    })
                });
                
                const data = await res.json();
                resultEl.className = 'result ' + (data.transaction_id ? 'success' : 'error');
                resultEl.textContent = JSON.stringify(data, null, 2);
            } catch (e) {
                resultEl.className = 'result error';
                resultEl.textContent = 'Error: ' + e.message;
            }
            btn.disabled = false;
        }
        
        async function loadAgentCard() {
            const resultEl = document.getElementById('agentResult');
            resultEl.style.display = 'block';
            resultEl.className = 'result';
            resultEl.textContent = 'Fetching...';
            
            try {
                const res = await fetch(API + '/.well-known/agent.json');
                const data = await res.json();
                resultEl.className = 'result success';
                resultEl.textContent = JSON.stringify(data, null, 2);
            } catch (e) {
                resultEl.className = 'result error';
                resultEl.textContent = 'Error: ' + e.message;
            }
        }
        
        function updateRpcParams() {
            const method = document.getElementById('rpcMethod').value;
            const paramsEl = document.getElementById('rpcParams');
            if (method === 'skills.list') {
                paramsEl.value = '{}';
            } else if (method === 'skills.invoke') {
                paramsEl.value = '{\n  "skill_id": "PASTE_ID_HERE",\n  "params": {}\n}';
            } else if (method === 'skills.register') {
                paramsEl.value = '{\n  "name": "My Skill",\n  "description": "A skill that does something useful for agents",\n  "category": "translation",\n  "price_sats": 100,\n  "endpoint": "https://example.com/api",\n  "lightning_address": "me@wallet.com",\n  "agent_name": "MyAgent"\n}';
            }
        }
        
        async function sendRPC() {
            const btn = event.target;
            const resultEl = document.getElementById('rpcResult');
            resultEl.style.display = 'block';
            resultEl.className = 'result';
            resultEl.textContent = 'Sending...';
            btn.disabled = true;
            
            try {
                let params;
                try {
                    params = JSON.parse(document.getElementById('rpcParams').value);
                } catch(e) {
                    params = {};
                }
                
                const res = await fetch(API + '/rpc', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        method: document.getElementById('rpcMethod').value,
                        params: params,
                        id: Date.now()
                    })
                });
                
                const data = await res.json();
                resultEl.className = 'result ' + (data.result ? 'success' : 'error');
                resultEl.textContent = JSON.stringify(data, null, 2);
            } catch (e) {
                resultEl.className = 'result error';
                resultEl.textContent = 'Error: ' + e.message;
            }
            btn.disabled = false;
        }
        
        async function checkHealth() {
            const resultEl = document.getElementById('healthResult');
            resultEl.style.display = 'block';
            resultEl.className = 'result';
            resultEl.textContent = 'Checking...';
            
            try {
                const res = await fetch(API + '/');
                const data = await res.json();
                resultEl.className = 'result success';
                resultEl.textContent = JSON.stringify(data, null, 2);
            } catch (e) {
                resultEl.className = 'result error';
                resultEl.textContent = 'Error: ' + e.message;
            }
        }
        
        async function checkSkillsCount() {
            const resultEl = document.getElementById('healthResult');
            resultEl.style.display = 'block';
            resultEl.className = 'result';
            
            try {
                const res = await fetch(API + '/skills');
                const data = await res.json();
                resultEl.className = 'result success';
                resultEl.textContent = 'Total skills in marketplace: ' + data.pagination.total;
            } catch (e) {
                resultEl.className = 'result error';
                resultEl.textContent = 'Error: ' + e.message;
            }
        }
        
        function esc(str) {
            const d = document.createElement('div');
            d.textContent = str || '';
            return d.innerHTML;
        }
        
        // Emoji search
        const emojiDB = [
            ['ü§ñ','robot ai bot agent machine'],['üõ°Ô∏è','shield security protect guard defense'],['üíª','laptop computer code dev pc'],
            ['üìä','chart data analytics graph stats bar'],['üåê','globe world web internet global network'],['üé®','art paint design palette creative'],
            ['üéµ','music note song audio sound'],['üé¨','movie film video camera cinema clip'],['üìù','memo note write edit document'],
            ['üîç','search find magnify look discover detective'],['üíú','purple heart love companion relationship'],['üí∞','money bag cash wealth rich dollar sats'],
            ['‚öñÔ∏è','balance scale law legal justice court'],['‚öïÔ∏è','medical health doctor hospital medicine care'],['üìö','books education study learn school read'],
            ['üöó','car auto vehicle drive automobile motor'],['üì°','satellite dish antenna signal iot sensor radar'],['‚ö°','lightning bolt fast electric power energy speed zap'],
            ['üîß','wrench tool fix repair mechanic develop'],['üìà','chart up growth trend increase stock market'],['üé≠','theater masks drama entertainment perform'],
            ['üéÆ','game controller play gaming console fun'],['‚úàÔ∏è','airplane plane travel flight trip fly'],['üí™','muscle strength fitness gym workout strong'],
            ['üì±','phone mobile cell app smartphone device'],['‚Çø','bitcoin btc crypto currency digital'],['üî¨','microscope research science lab experiment'],
            ['‚úçÔ∏è','writing hand pen author compose resume'],['üß±','brick build block infrastructure foundation wall'],['üì£','megaphone announce marketing promote shout'],
            ['ü¶ë','squid octopus tentacle sea ocean'],['üêï','dog pet animal canine puppy'],['üè†','house home building real estate property'],
            ['üçï','pizza food eat restaurant delivery meal'],['‚õìÔ∏è','chain link blockchain connect bond'],['üéØ','target bullseye goal aim focus dart'],
            ['üî•','fire hot flame trending popular burn'],['üí°','idea light bulb bright insight think'],['üåü','star glow shine sparkle rating'],
            ['üß†','brain smart intelligence mind think ai neural'],['üí¨','speech chat talk message bubble conversation'],['üìß','email mail message letter send inbox'],
            ['üîí','lock secure private password safe encrypt'],['üîì','unlock open access free public'],['üì¶','package box deliver ship product cargo'],
            ['üõí','cart shop buy store ecommerce purchase'],['üí≥','credit card payment pay checkout billing'],['üìÖ','calendar date schedule plan event time'],
            ['‚è±Ô∏è','timer clock speed time fast stopwatch'],['üåç','earth world globe planet map geography'],['üè¢','office building corporate company work business'],
            ['üë§','user person profile account identity avatar'],['üë•','users people group team crowd community'],['üìû','phone call telephone contact ring'],
            ['üñ•Ô∏è','desktop monitor screen display computer'],['‚öôÔ∏è','gear settings config configure option preference'],['üóÇÔ∏è','folder file organize category sort'],
            ['üì§','upload send share export outbox'],['üì•','download receive import inbox save'],['üîî','bell notification alert reminder ring'],
            ['üèÜ','trophy award winner champion prize first'],['üíé','gem diamond jewel premium valuable crystal'],['ü™Ñ','magic wand spell wizard transform'],
            ['üîó','link url connect chain web'],['üì∞','newspaper news article press media headline'],['üé§','microphone voice speak mic podcast sing'],
            ['üéß','headphone listen audio podcast music ear'],['üöÄ','rocket launch deploy ship start fast space'],['üí∏','money fly spend payment transaction fee'],
            ['ü§ù','handshake deal agreement partner trust'],['üìã','clipboard list task checklist todo'],['‚úÖ','check mark done complete yes approve'],
            ['‚ùå','cross no error wrong delete fail'],['‚ö†Ô∏è','warning alert caution danger'],['üîÆ','crystal ball predict future fortune oracle']
        ];
        
        function selectEmoji(emoji) {
            document.getElementById('skillIcon').value = emoji;
            document.getElementById('iconPreview').textContent = emoji;
        }
        
        function renderEmojis(list) {
            const container = document.getElementById('emojiResults');
            container.innerHTML = list.map(([emoji]) => 
                `<span onclick="selectEmoji('${emoji}')" style="cursor:pointer;font-size:22px;padding:5px;border-radius:4px;transition:background 0.15s;" onmouseover="this.style.background='rgba(0,217,255,0.2)'" onmouseout="this.style.background='none'">${emoji}</span>`
            ).join('');
        }
        
        function searchEmojis(query) {
            const q = query.toLowerCase().trim();
            if (!q) {
                renderEmojis(emojiDB);
                return;
            }
            const matches = emojiDB.filter(([emoji, tags]) => tags.includes(q) || tags.split(' ').some(t => t.startsWith(q)));
            renderEmojis(matches.length ? matches : emojiDB);
        }
        
        renderEmojis(emojiDB);

        // ========================================
        // SquidBot X Controls
        // ========================================
        async function checkXStatus() {
            const bar = document.getElementById('xStatusBar');
            const dot = document.getElementById('xStatusDot');
            const text = document.getElementById('xStatusText');
            try {
                const res = await fetch(API + '/x/status');
                const data = await res.json();
                if (data.configured) {
                    bar.className = 'x-status-bar connected';
                    dot.className = 'x-status-dot on';
                    text.textContent = 'X Connected ‚Äî @' + data.bot_handle + ' | Founder: @' + data.founder_handle;
                } else {
                    bar.className = 'x-status-bar disconnected';
                    dot.className = 'x-status-dot off';
                    text.textContent = 'X Not Configured';
                }
            } catch (e) {
                bar.className = 'x-status-bar disconnected';
                dot.className = 'x-status-dot off';
                text.textContent = 'Could not reach API';
            }
        }

        async function refreshSchedulerStatus() {
            try {
                const res = await fetch(API + '/scheduler/status');
                const data = await res.json();
                document.getElementById('statPosts').textContent = data.daily_posts || 0;
                document.getElementById('statReplies').textContent = data.daily_replies || 0;
                document.getElementById('statMaxPosts').textContent = data.max_posts_per_day || '-';
                document.getElementById('statMaxReplies').textContent = data.max_replies_per_day || '-';
            } catch (e) {
                console.error('Scheduler status error:', e);
            }
        }

        function switchXTab(tabName) {
            document.querySelectorAll('.x-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.x-tab-panel').forEach(p => p.classList.remove('active'));
            document.getElementById('xTab-' + tabName).classList.add('active');
            document.querySelectorAll('.x-tab').forEach(t => {
                if (t.getAttribute('onclick').includes(tabName)) t.classList.add('active');
            });
        }

        function showXResult(type, content, tweetUrl) {
            const el = document.getElementById('xResult');
            el.style.display = 'block';
            if (type === 'error') {
                el.innerHTML = '<div class="result error" style="margin-top:0;">' + esc(content) + '</div>';
            } else if (type === 'loading') {
                el.innerHTML = '<div class="result" style="margin-top:0; border-color: #1d9bf0; color: #1d9bf0;">' + esc(content) + '</div>';
            } else if (type === 'tweet') {
                el.innerHTML = `
                    <div class="x-tweet-preview">
                        <div class="tweet-header">
                            <div class="tweet-avatar">ü¶ë</div>
                            <div>
                                <div class="tweet-name">SquidBot</div>
                                <div class="tweet-handle">@squidbot</div>
                            </div>
                        </div>
                        <div class="tweet-body">${esc(content)}</div>
                        ${tweetUrl ? '<a href="' + tweetUrl + '" target="_blank" class="tweet-link">View on X ‚Üí</a>' : ''}
                    </div>
                `;
            }
        }

        function updateManualCharCount() {
            const text = document.getElementById('xManualText').value;
            const el = document.getElementById('xManualCharCount');
            const len = text.length;
            el.textContent = len + ' / 280';
            el.className = 'x-char-count' + (len > 280 ? ' over' : len > 250 ? ' warn' : '');
        }

        async function sendXPost() {
            const btn = document.getElementById('xPostBtn');
            btn.disabled = true;
            btn.textContent = 'ü¶ë Generating...';
            showXResult('loading', 'ü¶ë SquidBot is thinking...');
            try {
                const context = document.getElementById('xPostContext').value.trim();
                const res = await fetch(API + '/x/post', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'x-squidbay-key': adminKey },
                    body: JSON.stringify({ context: context || undefined })
                });
                const data = await res.json();
                if (data.success) {
                    showXResult('tweet', data.tweet, data.url);
                    refreshSchedulerStatus();
                } else {
                    showXResult('error', data.error || 'Unknown error');
                }
            } catch (e) {
                showXResult('error', 'Request failed: ' + e.message);
            }
            btn.disabled = false;
            btn.textContent = 'ü¶ë Generate & Post to X';
        }

        async function sendXReply() {
            const tweetId = document.getElementById('xReplyTweetId').value.trim();
            const mentionText = document.getElementById('xReplyMentionText').value.trim();
            if (!tweetId || !mentionText) {
                showXResult('error', 'Tweet ID and mention text required');
                return;
            }
            const btn = document.getElementById('xReplyBtn');
            btn.disabled = true;
            btn.textContent = 'ü¶ë Generating...';
            showXResult('loading', 'ü¶ë Crafting reply...');
            try {
                const author = document.getElementById('xReplyAuthor').value.trim();
                const res = await fetch(API + '/x/reply', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'x-squidbay-key': adminKey },
                    body: JSON.stringify({ tweet_id: tweetId, mention_text: mentionText, mention_author: author || 'someone' })
                });
                const data = await res.json();
                if (data.success) {
                    showXResult('tweet', data.reply, data.url);
                    refreshSchedulerStatus();
                } else {
                    showXResult('error', data.error || 'Unknown error');
                }
            } catch (e) {
                showXResult('error', 'Request failed: ' + e.message);
            }
            btn.disabled = false;
            btn.textContent = 'ü¶ë Generate & Reply';
        }

        async function sendXManual() {
            const text = document.getElementById('xManualText').value.trim();
            if (!text) {
                showXResult('error', 'Type something to post');
                return;
            }
            if (text.length > 280) {
                showXResult('error', 'Over 280 characters');
                return;
            }
            const btn = document.getElementById('xManualBtn');
            btn.disabled = true;
            btn.textContent = 'Posting...';
            showXResult('loading', 'Posting to X...');
            try {
                const res = await fetch(API + '/x/manual', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'x-squidbay-key': adminKey },
                    body: JSON.stringify({ text })
                });
                const data = await res.json();
                if (data.success) {
                    showXResult('tweet', data.tweet, data.url);
                    refreshSchedulerStatus();
                } else {
                    showXResult('error', data.error || 'Unknown error');
                }
            } catch (e) {
                showXResult('error', 'Request failed: ' + e.message);
            }
            btn.disabled = false;
            btn.textContent = 'Post Exact Text to X';
        }

        async function sendBanterPost() {
            const btn = document.getElementById('xBanterBtn');
            btn.disabled = true;
            btn.textContent = 'üé≠ Generating banter...';
            showXResult('loading', 'ü¶ë SquidBot is roasting you...');
            try {
                const res = await fetch(API + '/scheduler/post-now', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'x-squidbay-key': adminKey },
                    body: JSON.stringify({ type: 'banter' })
                });
                const data = await res.json();
                if (data.success) {
                    showXResult('loading', 'Banter posted! Check @SquidBot on X');
                    refreshSchedulerStatus();
                } else {
                    showXResult('error', data.error || 'Unknown error');
                }
            } catch (e) {
                showXResult('error', 'Request failed: ' + e.message);
            }
            btn.disabled = false;
            btn.textContent = 'üé≠ Post Banter Tweet';
        }
        
        checkStatus();
    </script>

    <script>
        async function runBulkFix() {
            const resultEl = document.getElementById('bulkFixResult');
            const passcode = document.getElementById('adminPasscode').value;
            
            const hash = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(passcode));
            const hex = Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
            if (hex !== 'b98e14bfea367b3025b946b8f2e20824956e014720ad2117b6e7b6dbc1db9f14') {
                resultEl.textContent = '‚ùå Invalid passcode.';
                return;
            }
            
            resultEl.textContent = 'Running bulk fixes... (check original test.html for full script)';
        }
    </script>
</body>
</html>
